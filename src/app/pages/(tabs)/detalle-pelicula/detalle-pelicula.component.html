<!-- Botón de volver según origen o por defecto -->
<div class="volver-fijo">
  <a [routerLink]="origen === 'perfil' ? '/perfil' : '/home'" class="volver-fijo-link">
    <i class="fa-solid fa-arrow-left"></i>
    {{
    origen === 'perfil'
    ? 'Volver a perfil'
    : 'Volver al inicio'
    }}
  </a>
</div>

<!-- Contenido principal -->
<div class="body" *ngIf="infoPelicula && actores">
  <div class="detalle-card">
    <div class="detalle-imagen">
      <img [src]="'https://image.tmdb.org/t/p/w500' + infoPelicula.poster_path" class="img-pelicula"
        alt="{{ infoPelicula.title }}" />
    </div>

    <div class="detalle-info">
      <h2>{{ infoPelicula.title }}</h2>
      <p class="tagline" *ngIf="infoPelicula.tagline">"{{ infoPelicula.tagline }}"</p>
      <p>{{ infoPelicula.overview }}</p>

      <p><strong>Duración:</strong> {{ infoPelicula.runtime }} min</p>
      <p><strong>Fecha de estreno:</strong> {{ infoPelicula.release_date }}</p>
      <p><strong>Géneros:</strong>
        <span *ngFor="let genre of infoGenres; let i = index">
          {{ genre.name }}<span *ngIf="i < infoGenres.length - 1">, </span>
        </span>
      </p>
    </div>
  </div>

  <!-- Reparto -->
  <div class="actores">
    <h3>Reparto principal</h3>
    <section class="actores_div">
      <div *ngFor="let actor of actores">
        <div class="actor">
          <img
            [src]="actor.profile_path ? 'https://image.tmdb.org/t/p/w500' + actor.profile_path : 'assets/sin-foto.png'"
            class="actor_imagen" />
          <div class="actor_nombre">{{ actor.name }}</div>
        </div>
      </div>
    </section>
  </div>

  <!-- Reseñas -->
  <div class="resenas">
    <h3>Opiniones</h3>

    <ng-container *ngIf="resenas && resenas.length > 0; else noResenas">
      <p class="puntuacion-media">
        Puntuación media: {{ puntuacionMedia }} ⭐
      </p>


      <div *ngFor="let r of resenas" class="resena">
        <p><strong>{{ r.puntuacion }} estrellas</strong></p>
        <p>{{ r.comentario }}</p>
        <hr />
      </div>
    </ng-container>

    <ng-template #noResenas>
      <p>Esta película aún no tiene reseñas.</p>
    </ng-template>

    <!-- Formulario para reseñar -->
    <!-- Formulario para reseñar -->
    <form *ngIf="infoPelicula && !miResena" (ngSubmit)="enviarResena(infoPelicula.id)">
      <h4>Escribe tu reseña</h4>

      <label>Puntuación:</label>
      <div class="estrellas">
        <i *ngFor="let estrella of [1, 2, 3, 4, 5]" class="fa-star" [class.fa-solid]="estrella <= nuevaPuntuacion"
          [class.fa-regular]="estrella > nuevaPuntuacion" (click)="nuevaPuntuacion = estrella"></i>
      </div>

      <label>Comentario:</label>
      <textarea [(ngModel)]="nuevoComentario" name="comentario" rows="3" required
        placeholder="Escribe tu opinión sobre la película..."></textarea>

      <button type="submit">Enviar reseña</button>
    </form>

    <!-- Mensaje si ya tiene reseña -->
    <div *ngIf="miResena" class="ya-reseñado">
      <p>Ya has enviado una reseña para esta película.</p>
    </div>

  </div>
</div>

<!-- Indicador de carga -->
<div class="body" *ngIf="!infoPelicula || !actores">
  <div class="loading">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>
</div>